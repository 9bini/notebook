# 환경별 스토리지 전환을 위한 설계(추상화)

## 상황 설명
기존 파일 업로드 로직은 MinIO에 고정되어 있었고, 운영 환경에서는 AWS S3를 사용하기로 결정되면서
**개발(local/dev)과 운영(prod)을 손쉽게 전환할 수 있는 구조가 필요해졌다.**

이를 해결하기 위해 스토리지 레이아웃을 다음과 같이 재설계했다.

### 1. FileStorageService 인터페이스 도입

파일 업로드/삭제 등의 기능을 공통 인터페이스로 정의하고 실제 구현은 환경에 따라 주입되는 방식으로 구조를 분리했다.

```
FileStorageService
├── MinioFileService (local/dev)
└── S3FileService (prod)
```

이렇게 하면 비즈니스 코드는 스토리지 구현체에 의존하지 않고, 항상 `FileStorageService`만 바라보게 된다.

### 2. @Profile 기반의 빈 전환

`FileStorageConfig`에서 다음과 같이 프로필을 지정하여 환경별로 어떤 스토리지 클라이언트를 사용할지 결정한다.

- `local`, `dev` → MinIO 사용
- `prod` → AWS S3 사용

Spring Boot의 `@Profile` 기능을 활용해 애플리케이션 실행 시점에 알맞은 구현체가 자동으로 주입된다.

### 3. 이 설계의 장점

1. **환경 전환 용이**
   - 운영/개발 환경을 오직 프로필만 바꿔서 전환 가능
   - 코드 변경 없음

2. **스토리지 구현체 변경 시 영향도 최소화**
   - FileStorageService 인터페이스를 기준으로 동작하기 때문에
     S3가 아닌 다른 스토리지를 도입해도 비즈니스 코드 변경이 거의 없다.

3. **확장성**
   - 향후 ‘Presigned URL 업로드 전용 서비스’,
     ‘이미지 리사이징 서비스’,
     ‘스토리지 마이그레이션’ 같은 기능도 각 구현체 확장으로 대응 가능하다.

### 4. 요약

프로필 기반의 스토리지 추상화 구조를 도입함으로써 **환경별 스토리지 전략을 유연하게 전환할 수 있는 지속 가능한 구조**를 만들었다.
이제 개발 환경에서는 MinIO, 운영 환경에서는 S3를 사용하되 비즈니스 레이어는 단일 인터페이스만 바라보면 되므로 유지보수성과 확장성이 크게 향상되었다.
