
# TIL - SSRF(Server-Side Request Forgery)와 URL 다운로드 방어

오늘 URL 기반 파일 업로드 기능을 만들면서, SSRF(Server-Side Request Forgery)라는 개념을 처음 제대로 인지하게 되었다.

## 1. SSRF가 무엇인가

SSRF는 **Server-Side Request Forgery(서버사이드 요청 위조)**로,
클라이언트가 서버에게 “이 URL로 요청 좀 보내줘”라고 시키는 기능을 악용해서
서버가 **내부망/민감 시스템으로 HTTP 요청을 보내도록 만드는 공격**이다.

서버는:
- 외부 이미지를 가져오는 줄 알고
- 실제로는 **서버 내부에서만 접근 가능한 엔드포인트**를 대신 호출하게 된다.

즉,
- "클라이언트 → 서버" 요청이 아니라,
- "서버 → 내부 시스템" 요청을 **공격자가 간접적으로 컨트롤**하는 셈이다.

## 오늘 추가한 최소 방어

오늘 UrlFileDownloader에 다음 방어 로직을 추가했다.

1. **스킴 제한**
   - `http`, `https`만 허용
   - `file://`, `ftp://` 같은 이상한 스킴은 차단

2. **사설 IP / localhost 차단**
   - `localhost`, `127.x`, `10.x`, `192.168.x`, `172.16~31.x` 대역을 막아서
   - 서버가 내부망/로컬호스트로 요청을 보내지 못하게 기본 방어막을 추가

3. **최대 파일 크기 제한 + 타임아웃**
   - 너무 큰 파일 다운로드로 인한 메모리 과다 사용 방지
   - 느린 응답으로 쓰레드가 오래 묶이는 현상 방지

### 요약

- "클라이언트가 URL을 주고, 서버가 그 URL로 HTTP 요청을 보내주는 기능"은 기본적으로 SSRF 공격 표면이다.
- 최소한:
  - 스킴 제한(http/https),
  - 사설 IP/localhost 차단,
  - 크기 제한/타임아웃
  정도는 넣어야 한다는 걸 배웠다.
